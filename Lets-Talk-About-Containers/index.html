<!doctype html>
<html lang="de">
  <head>
	<meta charset="utf-8">
	<title>FIXME(cglaubitz): INSERT TITLE HERE</title>
	<meta name="description" content="Containers then and now">
	<meta name="author" content="Christoph Glaubitz">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
	<link rel="stylesheet" href="../reveal.js-3.0.0/css/reveal.css">
	<link rel="stylesheet" href="../reveal.js-3.0.0/css/theme/syseleven.css" id="theme">
	<link rel="stylesheet" href="../reveal.js-3.0.0/lib/css/zenburn.css">
	<link rel="stylesheet" href="../font-awesome-4.3.0/css/font-awesome.min.css">
	<script>
		var link = document.createElement( 'link' );
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match( ../reveal.js-3.0.0/print-pdf/gi ) ? '../reveal.js-3.0.0/css/print/pdf.css' : '../reveal.js-3.0.0/css/print/paper.css';
		document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>
	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
  </head>
  <body>
    <div class="reveal">
      <div class="slides">

<section data-markdown data-separator="^\n---\n$" data-separator-vertical="^\n--\n$">
<pre><code></code></pre>
<script type="text/template" >
<!-- .slide: class="left" data-background="../reveal.js-3.0.0/sys11-images/140212-SYS11-Presentor-Background-01-Title-02-90.png" -->

Containers then and now<!-- .element: style="font-size:150%;" -->

<aside class="author">
Christoph Glaubitz<br>
Cloud Architect SysEleven GmbH<br>
<span class="location">ContainerDays Hamburg, 27 &amp; 28.06.2016</span>
</aside>

---

#### What could you expect from this talk?

* Brief introduction about our infrastructure
* Different ways of deploying software
* You need more than just a container

---

FIXME? THROW AWAY?
What qualifies me to give this talk?

* Working in the area of web development and shipping since 1999
* Worked as a dev guy as well as an ops guy

---

### What are you guys at SysEleven doing?

---

### Running two types of infrastructure!

---

### A new one, based on OpenStack…

![OpenStack](img/Cloud_OpenCloud_Chillin.png)

---

### … a legacy one, based on Parallels Virtuozzo…

![Virtuozzo](img/virtuozzo.jpg)

Note:

Which basically provides integration into OpenStack these days

---

### … but most important: Provide, maintain and monitor the infrastructure, our customers can deploy their code into.

Note:

* monitoring as in: doing 24x7 for our customers

---

### Let's step into the legacy platform

---

### In the past, Virtuozzo was basically

* image format
* local storage
* Linux based container runtime
 * (but maintained outside of mainline)

Note:

* around 2008
* Which is still true, but there is more

---

### But treating containers like usual virtual machines

* with a complete Linux running inside
* sure, except of the kernel
* injecting files to distribution dependend locations

Note:

* Your targeted distribution has to be supported
* But with a huge performance benefit over VMs

---

### Some more history

---

From the early days, we have decent trending and alerting for all the services the customer provides.

Note:

* nagios + zabbix for monitoring

---

In the beginning we managed physical machines, and the associated containers (or Virtual Environment / VE in Virtuozzo speach) in some wiki pages. New containers were created by hand, and added to the wiki page.

Note:

* Like you expect, this did not scale out very well.

---

Over the years, we developed some tools, to spawn new containers with a minimum set of needed configuration. But we still totally lack a customer facing API.

Note:

* Because of this we decided use OpenStack

---

### At some point, Configuration Management became cool

… and we added a Puppet Master to our infrastructure, and registered all the containers to it. Based on this, we automated much stuff, like provisioning of basic stuff to the container and registering services to the monitoring.

---

### These days we are running

* about 3200 of those containers
* on about 300 physical machines

---

# But

---

We still treat the containers like computers.

Note:

* more litally

---

![Giraf](img/giraf.jpg)

Note:

* like cute baby girafs

---

### A traditional setup is still

* MySQL master slave setup
* Admin server
* a bunch of App server
* maybe some kind of search engine

---

* We hand over these provisioned containers like they are physical computer.
 * Except that we are able to move the containers around without relevant downtime.
* The customer deploys specific software into it.
* We moinitor and maintain the services and the OS.
 * The customer maintains his own code.

Note:

* deploying in terms of syncing the code from Admin to App server
* this kind of deployment is soo 90th!

---

All this, you can still do in the new world(tm) of containers.

But it is definitely not intended to be used this way!

---

FIXME
There are some obvious problems with this kind of deployment.

Note:

and yes. Most of them where house-made, and aviodable even with this tech-stack

---

It is relatively difficult to build Virtuozzo templates (which is basically an image).

Note:

Mostly because of the individual VEs

---

It's not very reproducable.

Note:

In the best case, a new App server is a clone of a existing one.

But the entire setup is not very reproducable

---

In case of not cloning: Creation time dependencies.

Note:

Which makes it likely the setup fails because of 1 dependency that fails.

---

Customers software is not packaged in any way.

Note:

It is not easy to verify the installation

---

You don't have an overview of the versions of the deployed software.

---

Updates have to go to each container separately.

---

Rollbacks to a defined set of installed software and deployed software are nearly impossible.

Note:

For sure, everything is possible. Some thing just cause more pain.

Just to name a few

---

### What do we get from the shiny new world of containers?

---

First of all: Another layer of indirection!

---

Did I mention, that you should keep your infrastructure as boring as possible?

---

Interresting infrastructure tends to fail in interresting ways!

Note:

Anyway. Lets get back to the containers.

---

Thanks to Docker, it is very very easy to build images! 

Note:

Unfortunately it is also very easy to build crappy images

---

* Never ever build software in a container thought for production and leave traces of build utils!
 * Build in a prepared build-container, that only exists to create the artefact.
* You may should build packages for your targeted distribution.
 * Especially if you have dependencies to dist stuff.
* Use Best practices, the tool does not force you to do it right.

Note:

Read on image best practices and why deleting stuff does not reduce the image size!

---

At this point, you only have build dependencies!

No apt-get/git clone when spawning the container.

Note:

But this is totally up to you.

---

### The real fun starts when your image is created and lives in some registry!

Note:

* No matter if public or private

---

There are ways, like docker-compose or kubectl, to define and run a deployment.

Note:

* So you can test your deployment over and over agan.
* In case of docker-compose they can be set up even locally!
 * or against docker-swarm

---

Really. I dreamed of such things at some points in my IT-life.

---

In the past, I had to deal with deployments to specific hosts, rather than spawning new containers to replace old ones.

Note:

Again. Remember the cute giraf.

---

In any way: Your infrastructure is code as well.

Note:

Which is really good!

---

It is easy to build fresh setups for testing and Q&amp;A.

---

Later, the accepted deployment will be spawned for production.

---

But lets step back from full blown container orchestrations.

---

Even if you don't want to use that complicated and addition layers, you gained a huge benefit!

---

You can run your image everywhere!

Note:

* No matter what: Baremetal, AWS, OpenStack, Google Cloud Engine, you name it.
* Except of our legacy platform tue to technical restrictions.
* In new versions of Virtuozzo this would work fine too.

---

And this is IMHO the most important of the container movement. Far more than the default used technics cgroups/namespaces-stuff.

---

These days you can also run your Linux container image in:

* a chroot without cgroups/namespaces using rkt fly by CoreOS
* a small KVM (with an injected kernel), thanks to CoreOS and Intel

---

You can run it on FreeBSD using JetPack

---

You can even run on Windows!

---

And all this *without* any modification to your image!

---

### But there will be dragons!

---

In my experience, deployments fail more likely because of misconfigured next-hops (like DB), instead of crappy software.

Note:

* Anyway. You now can test it over and over again.

---

Plugging services together is more difficult in a floating environment.

Note:

* Things like Service Discovery are far out of scope here.

---

You decouple yourself from the exact host, the container is running on.

---

Which definitely does not mean, that you are free of any operational issues.

---

The opposite is true!

---

You have new things running in your infrastructure.

---

Like a new orchestration layer.

---

Or a distrobuted key/value-Store.

---

Some kind of Service Discovery.

---

You need someone to operate all the new stuff!

---

Again the opposite! You have to extend these skills by container debugging!

---

FIXME

For me, that sounds like creating more operational burdon, instead of reducing.

---

Debugging apps in containers becomes different.

---

You don't have to throw away your debugging skills!

---

### Your applications have to be changed!

---

They have to be "Cloud Ready".

Note:

Bingo

---

Small startup times.

Note:

Otherwise the benefit of not spawning an entire VM does not count.

---

Should be "stateless".

---

### But

---

You will always have stateful systems.

---

Deal with it.

---

Think about twice or three times.

---

This is the compliacted stuff to deploy!

---

Monitor those services very well!

---

Plan, test and **regulary trigger** failover mechanisms.

---

I strongly encourage you to read on this.

* https://charity.wtf/2016/05/31/wtf-is-operations-serverless/<!-- .element: style="font-size: 50%" -->
* https://charity.wtf/2016/05/31/operational-best-practices-serverless/<!-- .element: style="font-size: 50%" -->

---

### Back to us: Where could we use containers?

Note:

* reminding how we manage services so far.

---

A layer on top of OpenStack Compute Nodes

* kubernetes
* docker-swarm
* CoreOS fleet
* Orchestration e.g. via ansible

Note:

Yes. There are solutions from OpenStack. But they in fact do the same.

 * But may lock you into the OpenStack Container API

This is the only way to isolate customers from each other.

 * Most open source container orchestration solutions are not yet ready for multi tenancy

---

Customers could use base images from some official registry and build their own images.

Note:

* Like Docker Hub or quay by CoreOS

---

We could as well provide some base images that we maintain.

---

### But: Here will be some more Dragons

---

We have to maintain the additional layer!

One for each customer!

---

Do we monitor the services of the customer and be alarmed when they go down?

---

Or, do we just monitor the orchestration-layer?

---

What if there is a critical bug in some image?

---

Who is responsible to build a new "production" image?

---

Do we have access to customers code/artefacts to build a new image?

---

Or, do we just notify customers?

---

Who is responsible for rolling out the new image?

Note:

* To recap
* Currently we only update/maintain dist software.
* Do not touch the customers software.

---

All this, and more that I forgot here, may differ from one customer to the other.

---

### Is "onto of OpenStack" the only possible area to use containers?

---

Far away from what is possible!

---

For example, also OpenStack Services are…

---

… Services!

---

Why not maintaining a kubernetes cluster and run OpenStack as a Service?

---

Seriously!

![Stackanetes](img/tectonic-k8s-openstack.svg)

https://tectonic.com/blog/openstack-and-kubernetes-come-together.html

---

### These technologies are around there!

---

They will gain you benefits.

---

But they will introduce new layers of indirection, that you have to manage.

Note:

* or someone for you

---

Not everything fits into a container.

![float problem](img/float_problem.gif)

Note:

* No one forces you to use containers!

---

Nothing will solve all your problems

![Problems](img/all_problems.jpg)

---

# Use it!

---

# Check the ecosystem

* http://chrigl.de/slides/sysconf15-docker/#<!-- .element: style="font-size: 50%" -->
* http://chrigl.de/slides/sysconf15-docker/#/resources<!-- .element: style="font-size: 50%" -->

---

###  But use it wisely!

![Container fail](img/container-accident.jpg)

---

<!-- .slide: class="left" -->

## Thanks! Questions?<!-- .element: style="margin-left:-40px;" -->


![Christoph Glaubitz](../img/Chris.jpg)<!-- .element: style="float:left; margin-left:-40px; margin-right:30px !important;" -->

Contact me:<br>
<i class="fa fa-envelope"></i> [c.glaubitz@syseleven.de](mailto:c.glaubitz@syseleven.de)

Get Awesome Hosting:<br>
[SysEleven.de](http://www.syseleven.de)

Slides & Contribute:<br>
[ThomasLohner.github.io](https://ThomasLohner.github.io/slides/)


</script>
</section>

      </div>
    </div>
	<script src="../reveal.js-3.0.0/lib/js/head.min.js"></script>
	<script src="../reveal.js-3.0.0/js/reveal.js"></script>
	<script>
		// Full list of configuration options available at:
		// https://github.com/hakimel/reveal.js#configuration
		Reveal.initialize({
			controls: true,
			progress: true,
			history: true,
			center: true,
			slideNumber: false,
			hideAddressBar: true,
			transition: 'slide', // none/fade/slide/convex/concave/zoom
			// Optional reveal.js plugins
			dependencies: [
				{ src: '../reveal.js-3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: '../reveal.js-3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '../reveal.js-3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '../reveal.js-3.0.0/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
				{ src: '../reveal.js-3.0.0/plugin/zoom-js/zoom.js', async: true },
				{ src: '../reveal.js-3.0.0/plugin/notes/notes.js', async: true }
			]
		});
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3595616-6', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
